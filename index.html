<!DOCTYPE html>
<html lang="en">
<html>
<head>
    <script src='https://cdn.plot.ly/plotly-2.9.0.min.js'></script>
    <style>
        * {
          box-sizing: border-box;
        }
        .column {
            float: left;
            width: 33.333%;
            padding: 15px;
            height: 300px;
        }
        .row:after {
            content: "";
            display: table;
            clear: both;
        }
    </style>
</head>
<body>    
<div id="chartDiv"></div>
<div id="instructions" style="text-align:center;color:lightgrey"></div>

<div class="row">
    <div id="formDiv">
        <form id="chartForm">
            <div style="text-align:center;">
            <input type="submit" value="Update Chart" style="background-color:#F6F1F4;">
            </div>
            <div class="column" style="background-color:#F6F1F4;" id="column1">
            <label>Independent (<i>x</i>) Values or Labels</label>
            <div style="font-size:50%">separated by commas</div>
            <textarea id="x" name="x">Mon, Tues, Wed, Thurs, Fri</textarea>
            <br><br>
            <label>Independent (<i>x</i>) Axis Title</label>
            <br>
            <input id="xtitle" name="xtitle" type="text" value="x">
            <br><br>
            <label>Chart Title</label>
            <br>
            <input id="title" name="title" type="text" value="y vs. x">
            <br><br>
            <label>Show Legend</label>
            <input type="checkbox" id="legendToggle" name="legendToggle" value="false">
            <br><br>
            <input type="submit" value="Update Chart" style="background-color:#F6F1F4;">
        </div>
        <div class="column" style="background-color:#636EFA;"  id="column2">
            <label style="background-color:#FFFFFF;padding:10px;">Dependent (<i>y</i>) Values</label>
            <div style="font-size:50%">separated by commas</div>
            <textarea id="y" name="y">5,7,3,9,11</textarea>
            <br><br>
            <label style="background-color:#FFFFFF;padding:10px;">Dependent (<i>y</i>) Axis Title</label>
            <br>
            <input id="ytitle" name="ytitle" type="text" value="y">
            <br><br>
            <label style="background-color:#FFFFFF;padding:5px;">Chart Type</label>
            <br>
            <select id="chartType" name="chartType">
                <option value="bar">bar</option>
                <option value="scatter">scatter</option>
                <option value="line">line</option>
                <option value="pie">pie</option>
            </select>
            <br><br>
            <label style="background-color:#FFFFFF;padding:5px;">Marker Color</label>
            <br>
            <input type="color" id="markerColor" name="markerColor" value="#636EFA">
        </div>
        <div class="column" style="background-color:#F1553B;"  id="column3">
            <label style="background-color:#FFFFFF;padding:10px;">Dependent (<i>y</i>) Values 2</label>
            <div style="font-size:50%">optional, separated by commas</div>
            <textarea id="y2" name="y"></textarea>
            <br><br>
            <label style="background-color:#FFFFFF;padding:5px">Dependent (<i>y</i>) Axis Title 2</label>
            <br>
            <input id="y2title" name="y2title" type="text" value="">
            <br><br>
            <label style="background-color:#FFFFFF;padding:5px;">Chart Type</label>
            <br>
            <select id="chartType2" name="chartType2">
                <option value="bar">bar</option>
                <option value="scatter">scatter</option>
                <option value="line">line</option>
                <option value="pie">pie</option>
            </select>
            <br><br>
            <label style="background-color:#FFFFFF;padding:5px;">Marker Color</label>
            <br>
            <input type="color" id="markerColor2" name="markerColor2" value="#F1553B">
        </div>
    </form>
    </div>
</div>

<script>

window.addEventListener("load", colorPickerFunction, false);

function colorPickerFunction() {
    var marker_color_picker = document.getElementById("markerColor");
    var marker_color_picker2 = document.getElementById("markerColor2");
    //var marker_color_value = marker_color_picker.value;
    //var marker_color_value2 = marker_color_picker2.value;
    marker_color_picker.addEventListener("input", updateColors, false);
    marker_color_picker2.addEventListener("input", updateColors, false);
    marker_color_picker.addEventListener("change", updateColors, false);
    marker_color_picker2.addEventListener("change", updateColors, false);
    //marker_color_picker.select();
}//*/

function updateColors() {
    var marker_color = document.getElementById("markerColor").value;
    var marker_color2 = document.getElementById("markerColor2").value;
    document.getElementById("column2").style.backgroundColor = marker_color;
    document.getElementById("column3").style.backgroundColor = marker_color2;
    //document.getElementById("chartForm").submit();
}

var formElement = document.getElementById("chartForm");
formElement.addEventListener("submit", function(event) {
    event.preventDefault();
    var x_values = document.getElementById("x").value;//.replace(/,\s/g, ',');
    var y_values = document.getElementById("y").value;//.replace(/,\s/g, ',');
    var y2_values = document.getElementById("y2").value;//.replace(/,\s/g, ',');
    var x_title = document.getElementById("xtitle").value;
    var y_title = document.getElementById("ytitle").value;
    var y2_title = document.getElementById("y2title").value;
    var title_value = document.getElementById("title").value;
    var chart_type = document.getElementById("chartType").value;
    var chart_type2 = document.getElementById("chartType2").value;
    var marker_color = document.getElementById("markerColor").value;
    var marker_color2 = document.getElementById("markerColor2").value;
    var showLegend = document.getElementById("legendToggle").checked;
    document.getElementById("instructions").innerText = "Click the ðŸ“¸ icon at the top right of the chart to download.";
    
    var data1 = {
        x: x_values.split(","),
        y: y_values.split(","),
        name: y_title,
        type: chart_type,
        marker: {color: marker_color}
    };

    var data2 = {
        x: x_values.split(","),
        y: y2_values.split(","),
        name: y2_title,
        type: chart_type2,
        marker: {color: marker_color2}
    };

    if (chart_type == 'scatter') {
        data1["mode"] = 'markers';
    }

    var layout = {
        title: title_value,
        xaxis: {title: x_title},
        yaxis: {title: y_title},
        showlegend: showLegend,
    };
    
    if (chart_type == "pie") {
        var data1 = {
            labels: x_values.split(","),
            values: y_values.split(","),
            type: chart_type
        };
        if (x_title == "x") {x_title = "";} // so that we don't have a legend title of "x"
        var layout = {
            title: title_value,
            showlegend: showLegend,
            legend: {
                title: {text: x_title}
            }
        };
    }

    if (y2_values == "") {
        Plotly.newPlot('chartDiv', [data1], layout);
    } else {
        Plotly.newPlot('chartDiv', [data1, data2], layout);
    }
}, true);

</script>
</body>
</html>